@{
    ViewData["Title"] = "Главная страница монитора";
   
}
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>

<script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
<script src="~/lib/chart.js/chart.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.esm.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.esm.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
</head>
<body>
    <h1 class="display-1" align='center'>Мониторинг состояния базы данных</h1>
    <br />
    <div class="container-fluid" align='center' style="border-radius:70px">
    <h2 class="display-2"> Текущая нагрузка</h2>

    <div class="row container">
        
        <div class="col-md-4 card" style="background-color: #D0D0D0" align='center'>
            <div>
                <h5 class="display-5 card-header" style="border-radius:20px">70%</h5>
            </div>
           <div class="card-body">CPU</div> 
        </div>
         <div class="col-md-4 card" style="background-color: #D0D0D0" align='center'>
            <div>
                <h5 class="display-5 card-header" style="border-radius:20px">70%</h5>
            </div>
           <div class="card-body">RAM</div> 
        </div>
         <div class="col-md-4 card" style="background-color: #D0D0D0" align='center'>
            <div>
                <h5 class="display-5 card-header" style="border-radius:20px">70%</h5>
            </div>
           <div class="card-body">CPU</div> 
        </div>
    </div>
    </div>
    <br />
    <div class="container-fluid" align='center'>
        <h2 class="display-2"> Монитор изменений</h2>
        <br />
        <div class="container">
        <di class="row" alignt="center">


                            <input type="date" id="date1" class="form-control row-cols-md-3"/>

                            <input type="date" id="date2" class="form-control row-cols-md-3"/>
    
                            <button id="setFilterDate" class="btn form-control btn-outline-dark row-cols-md-3">Выбрать</button>

                            <button id="setRealTimeMonitor" class="btn  form-control btn-outline-dark row-cols-md-3">Мониторинг в реальном времени</button>




        </di v>
        </div>

        <canvas id="myChart" class="table" width="500" height="300">Диаграмма</canvas>

    </div>
    <div class="container-fluid" align='center'>
        <h4 class="display-4">Таблица всех изменений</h4>
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th>TableName</th>
                <th>Date</th>
                <th>Info</th>
            
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    testtable
                </td>
                <td>
                    08.09.2022
                </td>
                <td>
                    insert!
                </td>
            </tr>
            <tr>
                <td>
                    testtable
                </td>
                <td>
                    08.09.2022
                </td>
                <td>
                    insert!
                </td>
            </tr>

        </tbody>
    </table>
    </div>
    <script>
         </script>
    
    <script >
        // $(function () {
        //$('#datetimepicker1').datetimepicker({
        //    locale: 'ru'
        //    });
        //});
        var chart = new Chart("myChart",
                    {
                        type: 'line',
                        data:
                        {
                            labels: [],
                            datasets: [{
                                label: 'Количество изменений',
                                data: [],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)',
                                    'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            
                            scales: {
                            y: {
                                
                                beginAtZero: true
                            }
                            }       
                        }       
                    });



               var refreshIntervalRT;
           

             function updateChart()
                    {
                        
                        $.ajax({
                        type:"POST",
                        url:"/Home/GetLogs",
                        data: "",
                        contextType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function(data2){
                            chart.data.labels = data2[0];
                            chart.data.datasets[0].data = data2[1];
                            chart.update();
                           
                        },
                        error: function() {console.log(data);}
                        });

                    }
            $(document).ready(function() {
                 refreshIntervalRT = setInterval(updateChart,1000);
            });
             
            function SetRangedDate(obj)
            {
                $.ajax({
                        type:"POST",
                        url:"/Home/GetCertainLogs",
                        data: obj,
                        contextType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function(data2){
                            chart.data.labels = data2[0];
                            chart.data.datasets[0].data = data2[1];
                            chart.update();

                        },
                        error: function() {console.log(data);}
                        });
            }

                 $("#setFilterDate").click(function()
                 {
                     if ($("#date1").val() == "" || $("#date2").val() == "")
                     {
                         alert("Введите диапазон дат!");
                         console.log("error getting input data");
                         return;
                     }
                     if (Date.parse($("#date1").val()) > Date.parse($("#date2").val()))
                     {
                             alert("Укажите даты в корректном порядке! \nПервая дата: начальное значение, вторая дата: конечное значение.");
                            console.log("first date bigger than second");
                            return
                     }
                     var start = $("#date1").val();
                     var end = $("#date2").val();
                     console.log(start);
                     console.log(end);
                     var obj = {
                         StartDate: start,
                         EndDate: end
                     };
                     //console.log("#date2");
                     clearInterval(refreshIntervalRT);
                     console.log("clicked filter");
                     SetRangedDate(obj);
                 });


                 $("#setRealTimeMonitor").click(function(){
                     refreshIntervalRT = setInterval(updateChart,500);
                     updateChart});



    </script>

    
</body>